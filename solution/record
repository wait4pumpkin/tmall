以用户的历史购买比率作为先验，random时以该概率的两倍判决
随机，不需要训练，全部样本用于测试
Num of users:  884
203   2723   1378
All:  7.46% (Precision) 14.73% (Recall) 9.90% (F1)

直接用KNN，四种类型权重相同，不考虑时间因素
非监督，全部用户用于测试
前三个月做训练，最后一个月测试
前k个权值uniform（distance效果没有明显提高）
Num for test:  176
16   716   303
Test(k = 1): 2.23% (Precision) 5.28% (Recall) 3.14% (F1)
16   719   303
Test(k = 3): 2.23% (Precision) 5.28% (Recall) 3.13% (F1)
16   723   303
Test(k = 5): 2.21% (Precision) 5.28% (Recall) 3.12% (F1)
16   721   303
Test(k = 7): 2.22% (Precision) 5.28% (Recall) 3.12% (F1)
16   722   303
Test(k = 9): 2.22% (Precision) 5.28% (Recall) 3.12% (F1)
16   719   303
Test(k = 11): 2.23% (Precision) 5.28% (Recall) 3.13% (F1)
14   717   303
Test(k = 15): 1.95% (Precision) 4.62% (Recall) 2.75% (F1)

20   613   277
Test(k = 1): 3.26% (Precision) 7.22% (Recall) 4.49% (F1)
19   609   277
Test(k = 3): 3.12% (Precision) 6.86% (Recall) 4.29% (F1)
20   607   277
Test(k = 5): 3.29% (Precision) 7.22% (Recall) 4.52% (F1)
20   604   277
Test(k = 7): 3.31% (Precision) 7.22% (Recall) 4.54% (F1)
20   609   277
Test(k = 9): 3.28% (Precision) 7.22% (Recall) 4.51% (F1)
20   606   277
Test(k = 11): 3.30% (Precision) 7.22% (Recall) 4.53% (F1)
20   602   277
Test(k = 15): 3.32% (Precision) 7.22% (Recall) 4.55% (F1)

20   624   243
Test(k = 1): 3.21% (Precision) 8.23% (Recall) 4.61% (F1)
20   622   243
Test(k = 3): 3.22% (Precision) 8.23% (Recall) 4.62% (F1)
20   625   243
Test(k = 5): 3.20% (Precision) 8.23% (Recall) 4.61% (F1)
20   623   243
Test(k = 7): 3.21% (Precision) 8.23% (Recall) 4.62% (F1)
20   623   243
Test(k = 9): 3.21% (Precision) 8.23% (Recall) 4.62% (F1)
20   620   243
Test(k = 11): 3.23% (Precision) 8.23% (Recall) 4.63% (F1)
20   622   243
Test(k = 15): 3.22% (Precision) 8.23% (Recall) 4.62% (F1)

20   706   288
Test(k = 1): 2.83% (Precision) 6.94% (Recall) 4.02% (F1)
20   712   288
Test(k = 3): 2.81% (Precision) 6.94% (Recall) 4.00% (F1)
20   712   288
Test(k = 5): 2.81% (Precision) 6.94% (Recall) 4.00% (F1)
19   710   288
Test(k = 7): 2.68% (Precision) 6.60% (Recall) 3.81% (F1)
19   713   288
Test(k = 9): 2.66% (Precision) 6.60% (Recall) 3.80% (F1)
19   712   288
Test(k = 11): 2.67% (Precision) 6.60% (Recall) 3.80% (F1)
19   709   288
Test(k = 15): 2.68% (Precision) 6.60% (Recall) 3.81% (F1)

13   553   258
Test(k = 1): 2.35% (Precision) 5.04% (Recall) 3.21% (F1)
13   550   258
Test(k = 3): 2.36% (Precision) 5.04% (Recall) 3.22% (F1)
13   550   258
Test(k = 5): 2.36% (Precision) 5.04% (Recall) 3.22% (F1)
13   551   258
Test(k = 7): 2.36% (Precision) 5.04% (Recall) 3.21% (F1)
13   550   258
Test(k = 9): 2.36% (Precision) 5.04% (Recall) 3.22% (F1)
13   547   258
Test(k = 11): 2.38% (Precision) 5.04% (Recall) 3.23% (F1)
13   551   258
Test(k = 15): 2.36% (Precision) 5.04% (Recall) 3.21% (F1)



数据分析（使用四个月的数据）
用户数：884
品牌数：57655（不同的用户的同一品牌视为不同品牌）
动作次数：174539（点击）6984（购买）1204（收藏）153（购物车）

关键问题：是否会购买一次以上
购买的品牌数：4525（占总品牌数的7.85%）
七成以上属于单次购买
1 3450 76.24%
2 626 13.83%
3 190 4.20%
4 96 2.12%
5 49 1.08%
6 38 0.84%
7 18 0.40%
8 10 0.22%
9 9 0.20%
10 8 0.18%
11 8 0.18%
12 6 0.13%
13 1 0.02%
14 2 0.04%
15 1 0.02%
16 3 0.07%
17 3 0.07%
18 1 0.02%
19 1 0.02%
20 1 0.02%
21 0 0.00%
22 1 0.02%
23 1 0.02%
24 0 0.00%
25 0 0.00%
26 0 0.00%
27 0 0.00%
28 0 0.00%
29 0 0.00%
30 0 0.00%
31 1 0.02%
32 0 0.00%
33 0 0.00%
34 0 0.00%
35 0 0.00%
36 0 0.00%
37 0 0.00%
38 0 0.00%
39 0 0.00%
40 1 0.02%

分析对单个品牌操作的时间跨度
绝大部分是当天完成的
0 46887 81.32%
1 1237 2.15%
2 633 1.10%
3 534 0.93%
4 410 0.71%
5 341 0.59%
6 326 0.57%
7 297 0.52%
8 252 0.44%
9 212 0.37%
10 187 0.32%
11 181 0.31%
12 177 0.31%
13 178 0.31%
14 167 0.29%
15 133 0.23%
16 138 0.24%
17 133 0.23%
18 115 0.20%
19 121 0.21%
20 111 0.19%
21 136 0.24%
22 115 0.20%
23 102 0.18%
24 93 0.16%
25 104 0.18%
26 112 0.19%
27 100 0.17%
28 83 0.14%
29 112 0.19%
30 99 0.17%
31 104 0.18%
32 87 0.15%
33 100 0.17%
34 96 0.17%
35 81 0.14%
36 76 0.13%
37 80 0.14%
38 82 0.14%
39 63 0.11%
40 83 0.14%
41 57 0.10%
42 74 0.13%
43 70 0.12%
44 81 0.14%
45 71 0.12%
46 84 0.15%
47 59 0.10%
48 69 0.12%
49 66 0.11%
50 66 0.11%
51 55 0.10%
52 48 0.08%
53 64 0.11%
54 53 0.09%
55 71 0.12%
56 56 0.10%
57 45 0.08%
58 49 0.08%
59 45 0.08%
60 54 0.09%
61 65 0.11%
62 55 0.10%
63 70 0.12%
64 45 0.08%
65 62 0.11%
66 45 0.08%
67 41 0.07%
68 32 0.06%
69 40 0.07%
70 52 0.09%
71 46 0.08%
72 35 0.06%
73 35 0.06%
74 47 0.08%
75 43 0.07%
76 36 0.06%
77 31 0.05%
78 34 0.06%
79 40 0.07%
80 35 0.06%
81 27 0.05%
82 32 0.06%
83 34 0.06%
84 36 0.06%
85 25 0.04%
86 38 0.07%
87 31 0.05%
88 39 0.07%
89 32 0.06%
90 29 0.05%
91 31 0.05%
92 29 0.05%
93 22 0.04%
94 25 0.04%
95 20 0.03%
96 23 0.04%
97 22 0.04%
98 30 0.05%
99 27 0.05%
100 19 0.03%
101 20 0.03%
102 18 0.03%
103 17 0.03%
104 12 0.02%
105 12 0.02%
106 16 0.03%
107 18 0.03%
108 14 0.02%
109 6 0.01%
110 13 0.02%
111 13 0.02%
112 11 0.02%
113 10 0.02%
114 12 0.02%
115 10 0.02%
116 11 0.02%
117 10 0.02%
118 15 0.03%
119 9 0.02%
120 14 0.02%
121 8 0.01%
122 8 0.01%
123 3 0.01%

然后分析购买和不购买的时间跨度
购买的跨度越大，购买的可能性增加
None
0 45044 84.78%
1 900 1.69%
2 460 0.87%
3 352 0.66%
4 269 0.51%
5 219 0.41%
6 214 0.40%
7 203 0.38%
8 167 0.31%
9 144 0.27%
10 125 0.24%
11 133 0.25%
12 131 0.25%
13 143 0.27%
14 127 0.24%
15 109 0.21%
16 114 0.21%
17 112 0.21%
18 86 0.16%
19 97 0.18%
20 92 0.17%
21 109 0.21%
22 99 0.19%
23 78 0.15%
24 78 0.15%
25 91 0.17%
26 90 0.17%
27 80 0.15%
28 64 0.12%
29 99 0.19%
30 77 0.14%
31 79 0.15%
32 68 0.13%
33 82 0.15%
34 81 0.15%
35 57 0.11%
36 64 0.12%
37 70 0.13%
38 63 0.12%
39 49 0.09%
40 66 0.12%
41 48 0.09%
42 51 0.10%
43 54 0.10%
44 72 0.14%
45 57 0.11%
46 67 0.13%
47 45 0.08%
48 57 0.11%
49 51 0.10%
50 49 0.09%
51 45 0.08%
52 40 0.08%
53 51 0.10%
54 41 0.08%
55 56 0.11%
56 44 0.08%
57 33 0.06%
58 38 0.07%
59 40 0.08%
60 48 0.09%
61 55 0.10%
62 45 0.08%
63 58 0.11%
64 35 0.07%
65 52 0.10%
66 35 0.07%
67 29 0.05%
68 27 0.05%
69 37 0.07%
70 40 0.08%
71 35 0.07%
72 30 0.06%
73 27 0.05%
74 39 0.07%
75 31 0.06%
76 26 0.05%
77 22 0.04%
78 22 0.04%
79 27 0.05%
80 27 0.05%
81 23 0.04%
82 25 0.05%
83 29 0.05%
84 29 0.05%
85 22 0.04%
86 31 0.06%
87 23 0.04%
88 30 0.06%
89 22 0.04%
90 26 0.05%
91 26 0.05%
92 15 0.03%
93 18 0.03%
94 21 0.04%
95 11 0.02%
96 21 0.04%
97 18 0.03%
98 24 0.05%
99 25 0.05%
100 18 0.03%
101 15 0.03%
102 13 0.02%
103 15 0.03%
104 9 0.02%
105 10 0.02%
106 13 0.02%
107 15 0.03%
108 8 0.02%
109 5 0.01%
110 8 0.02%
111 7 0.01%
112 7 0.01%
113 8 0.02%
114 9 0.02%
115 7 0.01%
116 9 0.02%
117 7 0.01%
118 12 0.02%
119 5 0.01%
120 8 0.02%
121 6 0.01%
122 5 0.01%
123 1 0.00%

Buy
0 1843 40.73%
1 337 7.45%
2 173 3.82%
3 182 4.02%
4 141 3.12%
5 122 2.70%
6 112 2.48%
7 94 2.08%
8 85 1.88%
9 68 1.50%
10 62 1.37%
11 48 1.06%
12 46 1.02%
13 35 0.77%
14 40 0.88%
15 24 0.53%
16 24 0.53%
17 21 0.46%
18 29 0.64%
19 24 0.53%
20 19 0.42%
21 27 0.60%
22 16 0.35%
23 24 0.53%
24 15 0.33%
25 13 0.29%
26 22 0.49%
27 20 0.44%
28 19 0.42%
29 13 0.29%
30 22 0.49%
31 25 0.55%
32 19 0.42%
33 18 0.40%
34 15 0.33%
35 24 0.53%
36 12 0.27%
37 10 0.22%
38 19 0.42%
39 14 0.31%
40 17 0.38%
41 9 0.20%
42 23 0.51%
43 16 0.35%
44 9 0.20%
45 14 0.31%
46 17 0.38%
47 14 0.31%
48 12 0.27%
49 15 0.33%
50 17 0.38%
51 10 0.22%
52 8 0.18%
53 13 0.29%
54 12 0.27%
55 15 0.33%
56 12 0.27%
57 12 0.27%
58 11 0.24%
59 5 0.11%
60 6 0.13%
61 10 0.22%
62 10 0.22%
63 12 0.27%
64 10 0.22%
65 10 0.22%
66 10 0.22%
67 12 0.27%
68 5 0.11%
69 3 0.07%
70 12 0.27%
71 11 0.24%
72 5 0.11%
73 8 0.18%
74 8 0.18%
75 12 0.27%
76 10 0.22%
77 9 0.20%
78 12 0.27%
79 13 0.29%
80 8 0.18%
81 4 0.09%
82 7 0.15%
83 5 0.11%
84 7 0.15%
85 3 0.07%
86 7 0.15%
87 8 0.18%
88 9 0.20%
89 10 0.22%
90 3 0.07%
91 5 0.11%
92 14 0.31%
93 4 0.09%
94 4 0.09%
95 9 0.20%
96 2 0.04%
97 4 0.09%
98 6 0.13%
99 2 0.04%
100 1 0.02%
101 5 0.11%
102 5 0.11%
103 2 0.04%
104 3 0.07%
105 2 0.04%
106 3 0.07%
107 3 0.07%
108 6 0.13%
109 1 0.02%
110 5 0.11%
111 6 0.13%
112 4 0.09%
113 2 0.04%
114 3 0.07%
115 3 0.07%
116 2 0.04%
117 3 0.07%
118 3 0.07%
119 4 0.09%
120 6 0.13%
121 2 0.04%
122 3 0.07%
123 2 0.04%

测试（仅使用前三个月数据，最后一个月数据用于验证）
首先验证，最后一个月购买的是否之前已经购买过
这个信息十分重要
从结果上看，可以说基本上全部都是没有购买过的
Total: 57655
Twice: 89 0.15%

根据这一结果
继续验证最后一个月购买的品牌是否第一次出现
（对于单个用户来说，不考虑协同滤波）
在最后一个月购买的绝大部分是之前从来没有操作过的
Total: 1378
New: 1289 93.54%

上一个结果很关键
这表明不能只考虑单个用户的行为
因为单个用户显然无法预测从未出现过的品牌
必须通过协同滤波解决

继续验证
最后一个月出现的品牌是否曾经出现过
九成的品牌在前三个月已经出现
对于余下一成显然是无能为力的
Train brands: 9432
Test brands: 900
New: 97 10.78%

最后购买的商品只有少数用户是曾经浏览过的
1378 87 6.31%

到了这一步更加确定是必须要用协同滤波
而最高的准确率也只能达到八九成
对于未出现过的品牌的显然是无法预测的

接下来测试用户购买品牌之间的重叠率是多少
这将决定协同滤波的效果（观察四个月数据）
取每个用户和其他用户的品牌重叠率最大值
大部分用户的最大重叠率都达到1
平均最大重叠率约为80%
说明必定存在可以协同滤波的用户

UserCF和ItemCF都存在的问题
八百多的用户，最后一个月购买的数量也只有一千多
平均每个用户购买数不到2
如果直接采用每个用户top-n预测
则precision必定很低
测试最后一个月每个用户购买的数量
四成用户是没有购买的
0 353 39.93%
1 203 22.96%
2 132 14.93%
3 78 8.82%
4 50 5.66%
5 20 2.26%
6 22 2.49%
7 5 0.57%
8 7 0.79%
9 5 0.57%
10 3 0.34%
12 2 0.23%
13 1 0.11%
14 3 0.34%

分析每个用户购买的品牌数（四个月）
0 136 15.38%
1 103 11.65%
2 105 11.88%
3 101 11.43%
4 62 7.01%
5 66 7.47%
6 51 5.77%
7 42 4.75%
8 39 4.41%
9 41 4.64%
10 21 2.38%
11 21 2.38%
12 21 2.38%
13 12 1.36%
14 10 1.13%
15 7 0.79%
16 8 0.90%
17 11 1.24%
18 5 0.57%
19 7 0.79%
20 5 0.57%
22 1 0.11%
23 2 0.23%
24 2 0.23%
26 1 0.11%
28 1 0.11%
30 1 0.11%
64 1 0.11%
54 1 0.11%
也就是大部分用户购买的品牌并不多，购买行为很少
Random的效果不错也就是印证了这一点
随机中大部分都选择了不购买

分析品牌的特性
首先是品牌的流行度
统计每个品牌在不同用户出现的频率（四个月）（倒排）
1 3178 0.11% 33.34%
2 1341 0.23% 14.07%
3 735 0.34% 7.71%
4 480 0.45% 5.04%
5 328 0.57% 3.44%
6 248 0.68% 2.60%
7 196 0.79% 2.06%
8 159 0.90% 1.67%
9 149 1.02% 1.56%
10 118 1.13% 1.24%
11 88 1.24% 0.92%
13 74 1.47% 0.78%
12 65 1.36% 0.68%
14 59 1.58% 0.62%
15 53 1.70% 0.56%
16 53 1.81% 0.56%
18 36 2.04% 0.38%
17 34 1.92% 0.36%
24 31 2.71% 0.33%
22 27 2.49% 0.28%
19 25 2.15% 0.26%
20 25 2.26% 0.26%
21 22 2.38% 0.23%
23 22 2.60% 0.23%
31 19 3.51% 0.20%
27 16 3.05% 0.17%
25 15 2.83% 0.16%
26 15 2.94% 0.16%
29 14 3.28% 0.15%
28 12 3.17% 0.13%
30 12 3.39% 0.13%
32 10 3.62% 0.10%
33 9 3.73% 0.09%
37 9 4.19% 0.09%
43 8 4.86% 0.08%
46 8 5.20% 0.08%
34 7 3.85% 0.07%
36 7 4.07% 0.07%
40 6 4.52% 0.06%
41 6 4.64% 0.06%
44 6 4.98% 0.06%
87 6 9.84% 0.06%
35 5 3.96% 0.05%
39 5 4.41% 0.05%
42 5 4.75% 0.05%
57 5 6.45% 0.05%
51 4 5.77% 0.04%
58 4 6.56% 0.04%
68 4 7.69% 0.04%
38 3 4.30% 0.03%
45 3 5.09% 0.03%
47 3 5.32% 0.03%
62 3 7.01% 0.03%
64 3 7.24% 0.03%
65 3 7.35% 0.03%
72 3 8.14% 0.03%
101 3 11.43% 0.03%
48 2 5.43% 0.02%
54 2 6.11% 0.02%
55 2 6.22% 0.02%
56 2 6.33% 0.02%
67 2 7.58% 0.02%
70 2 7.92% 0.02%
75 2 8.48% 0.02%
77 2 8.71% 0.02%
82 2 9.28% 0.02%
103 2 11.65% 0.02%
116 2 13.12% 0.02%
49 1 5.54% 0.01%
52 1 5.88% 0.01%
53 1 6.00% 0.01%
59 1 6.67% 0.01%
60 1 6.79% 0.01%
63 1 7.13% 0.01%
66 1 7.47% 0.01%
69 1 7.81% 0.01%
73 1 8.26% 0.01%
78 1 8.82% 0.01%
79 1 8.94% 0.01%
84 1 9.50% 0.01%
85 1 9.62% 0.01%
86 1 9.73% 0.01%
89 1 10.07% 0.01%
91 1 10.29% 0.01%
99 1 11.20% 0.01%
117 1 13.24% 0.01%
120 1 13.57% 0.01%
122 1 13.80% 0.01%
123 1 13.91% 0.01%
126 1 14.25% 0.01%
133 1 15.05% 0.01%
137 1 15.50% 0.01%
138 1 15.61% 0.01%
140 1 15.84% 0.01%
142 1 16.06% 0.01%
145 1 16.40% 0.01%
148 1 16.74% 0.01%
152 1 17.19% 0.01%
166 1 18.78% 0.01%
218 1 24.66% 0.01%
232 1 26.24% 0.01%
大约有三成以上商品会出现在十个用户以上

部分品牌是单次购买
部分品牌会多次购买
是否存在该规律

预测重复性购买的品牌
重复购买的品牌在时间上应该存在有规律性


由此可以看出，第一步应该是判断用户是否会购买
这一步应该可以有效提高precision
第一种最简单的想法
直接用四种行为的数量预测是否会购买
特征：所有操作过的品牌数 + 每种操作的数量























